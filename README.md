# High-Performance FST Waveform Writer

A modern C++14 re-implementation of the **Fast Signal Trace (FST)** waveform writer, originally designed for [GtkWave](http://gtkwave.sourceforge.net/).

## ğŸš€ Overview

This project provides a highly optimized, standard-compliant C++ implementation of the FST writer API. The core of this project is written in **C++14** to ensure maximum compatibility with EDA tools and environments (which is usually a bit outdated), specifically targeting performance improvements for **Verilator** simulations.

The unittests are written in C++20.

### Key Features
- **C++14**: The core of this project is written in clean C++14 to maximize compatibility.
- **High Performance**: Optimized for speed to reduce simulation overhead (2x faster than the original `fstapi` when used with Verilator).
- **Drop-in Compatibility**: Includes an optional C-compatible wrapper (`fstapi.cpp`) that mimics the original `fstapi.c` interface.
- **Robust Testing**: Comprehensive unit tests written in C++20 to ensure correctness.

---

## ğŸ“‚ Project Structure

Every file of this project is under the `src` directory, which also includes third-party files:

```
fstcpp/              # ğŸŒŸ MAIN: Core C++ implementation
â”œâ”€â”€ Writer.hpp       #    - The new C++ API header
â”œâ”€â”€ Writer.cpp       #    - The implementation
gtkwave/             # ğŸ“š ORIGINAL: Original GtkWave files
â”œâ”€â”€ fstapi.cpp       #    - C-style wrapper for backward compatibility
â”œâ”€â”€ fstapi.c         #    - REFERENCE: the original GtkWave implementation
â””â”€â”€ fstapi.h         #    - The original GtkWave header file used by both fstapi.cpp and fstapi.c
integration_test/    # ğŸ§ª TESTS: Integration tests generated by Verilator
```

### Licensing Detailed
The project contains a mix of original code and redistributed files:

*   **`src/fstcpp/`**: The core of this project. Licensed under **MIT**.
*   **`src/gtkwave/`**: Redistributed from GtkWave. **MIT** or **BSD-2-Clause** (see file headers).
*   **`src/fstcpp/string_view.hpp`**: Lightweight `string_view` implementation. **Boost Software License**.
*   **`src/integration_test/`**: Generated by Verilator 5.042. Follows Verilator's license. Except for `Simple.sv` and `Simple_tb.test.cpp`, which are part of this project.

---

## ğŸ› ï¸ Build & Installation

### Prerequisites
*   C++20 compatible compiler (GCC/Clang)
*   CMake (3.10 or higher)
*   Ninja (optional, recommended for speed)

### Setup for Development (VS Code)

To configure the project with debug symbols and prepare it for VS Code clangd:

```bash
# Generate build files using Ninja
cmake -G Ninja -B build/debug -DCMAKE_BUILD_TYPE=Debug src
```

### Compiling

```bash
# Build the project
cmake --build build/debug
```

---

## ğŸ§ª Testing and Verification

This project uses a rigorous testing strategy, combining unit tests (C++20) and integration tests with Verilator.

To run the unit tests:

```bash
cd build/debug
ctest --verbose
```

For coverage reports (requires `lcov`):

```bash
# Run coverage script
./run_coverage.sh
```

---

## ğŸ“š References

*   [FST Waveform Specification (Unofficial)](https://blog.timhutt.co.uk/fst_spec/) - A great resource for understanding the FST format internals.
*   [Benchmark](https://github.com/yodalee/verilator_snapshot) - Contains performance benchmarks.

---

## ğŸ“„ License

The main source code of this repository is licensed under the **MIT License**.
See the [LICENSE](LICENSE) file for more details.
